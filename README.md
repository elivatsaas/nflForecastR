# NFL Point Differential Forecasting

A simple NFL game prediction system that backtests on 2024 data and generates predictions for upcoming weeks.

## ⚠️ Important Disclaimer

This package is provided for informational and educational purposes only. Any predictions, analyses, or insights generated by nflForecastR should not be considered as gambling or betting advice. Sports betting involves significant risk and can lead to financial losses. Users of this package assume full responsibility for:

- Any decisions made based on the package's outputs
- Compliance with all applicable local, state, and federal laws regarding sports betting
- Any financial losses that may occur from betting activities

The authors and contributors of nflForecastR are not responsible for any losses, damages, or legal issues that may arise from using this package for betting purposes. If you have a gambling problem, please call 1-800-GAMBLER for support.

## Installation

```r
remotes::install_github("elivatsaas/nflForecastR", dependencies = TRUE)
library(nflForecastR)
library(dplyr)
```

## What This Code Does

### Target Variable Options

You can predict any `_outcome` variable in the dataset as your target. This example uses `point_differential_outcome`, but you could also predict:
- `home.points_scored_outcome` (home team points)
- `home.off_epa_outcome` (home team offensive EPA)
- `home.qb_passer_rating_outcome` (home team QB rating)
- Any other `_outcome` variable available

### Part 1: Historical Backtesting

The first section builds a dataset from 2015-2024 and tests how well the model would have performed on the 2024 season:

```r
# Build historical data
games <- prepare_games(
  years            = 2015:2024,
  include_injuries = FALSE,  # These features are turned off
  include_coaching = TRUE,
  include_referee  = FALSE,
  seed_week1       = TRUE
)

# Example formula - you can customize this
FORMULA <- point_differential_outcome ~ spread_line + home.off_epa_last3 + away.def_epa_last3

# Test on 2024 season (weeks 1-18)
bt <- backtest_model(
  years               = 2024,
  start_week          = 1,
  end_week            = 18,
  model_type          = "lm",
  formula             = FORMULA,
  target_outcome      = "point_differential_outcome",
  all_updated_games   = games
)
```

This outputs:
- Overall prediction accuracy metrics
- Sample predictions showing predicted vs actual point differentials

### Part 2: Live Predictions

The second section trains on historical data and makes predictions for upcoming games:

```r
# Prepare training data and games to predict
data <- prepare_predictions(
  target_week      = 2,     # Predicting week 2
  target_season    = 2025,  # For 2025 season
  training_start   = 2015,  # Train on 2015-2024 data
  include_coaching = TRUE,
  include_referee  = FALSE,
  include_injuries = FALSE,
  seed_week1       = TRUE
)

# Train the model
fit <- stats::lm(FORMULA, data = data$training)

# Make predictions and generate picks
predicted_margin <- predict(fit, newdata = data$prediction)

picks <- data$prediction %>%
  mutate(
    predicted_margin = predicted_margin,
    pick_winner      = if_else(predicted_margin > 0, home_team, away_team),
    ats_lean         = if_else(predicted_margin - spread_line > 0,
                               paste0(home_team, " -", abs(spread_line)),
                               paste0(away_team, " +", abs(spread_line)))
  ) %>%
  arrange(season, week, home_team)

# Display results
cat("\n=== MODEL ===\n")
print(FORMULA)

cat("\n=== PREDICTIONS (top 20) ===\n")
print(head(select(picks, season, week, home_team, away_team,
                  spread_line, predicted_margin, pick_winner, ats_lean), 20), 
      row.names = FALSE)
```

This outputs a picks table with:
- `predicted_margin`: How many points the home team is expected to win/lose by
- `pick_winner`: Which team is predicted to win straight up
- `ats_lean`: Against-the-spread recommendation

## Key Design Choices

- **No data leakage**: Only uses information available before games start
- **Customizable features**: You can experiment with different combinations of the hundreds of available features
- **Excludes certain features**: Referee and injury data are turned off in this example
- **Complete cases only**: Drops games missing any predictor values

## Output Example

```
   season  week home_team away_team spread_line predicted_margin pick_winner ats_lean 
    <int> <int> <chr>     <chr>           <dbl>            <dbl> <chr>       <chr>    
 1   2025     2 ARI       CAR               6.5             6.34 ARI         CAR +6.5 
 2   2025     2 BAL       CLE              11.5            12.5  BAL         BAL -11.5
```
